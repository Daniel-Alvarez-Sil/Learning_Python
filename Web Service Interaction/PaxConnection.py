#Programa para Realizar la Conexion con PAX para Facturar

import requests

#Definición de Variables
cURL = "https://test.paxfacturacion.com.mx:453/webservices/wcfRecepcionASMX.asmx?wsdl -nohostverify -Port wcfRecepcionASMXSoap"
cDoc = '<cfdi:Comprobante xmlns:cfdi="http://www.sat.gob.mx/cfd/3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv33.xsd" Version="3.3" TipoCambio="1" Serie="FC" Folio="90" Fecha="2022-11-09T13:24:44" Sello="JkORytiJaCg6vkbhguGDjKcrSD78bef645834eugXVoAkXFAg5XozM555JDKmevQ7MuWYaIAmE9K7Hssv/WOy02HOylUp2M2WTSkyXVj4FXI6ZVQhSTtSVf5+diaDdcXAGfb+jeyoGPoPf95xE3wlfrZ4OmBFfBOXuYKnXOEDls1i38hTGzmnXIzMvrA4Sy9UtI1x0B6RnFTYhsTJIA9RIti8LXGX1V5z0jCS4d5sEoUWa77lc1k0W4oZGjbDKiUnXp4ui/7TF/L4alAfa8sShM4CXZ1GzwJFsRc8nENzD//XDd+Z8o7ZAZbGElqa3c/MJECKLBe02+mEdrcJsGE4Q==" FormaPago="99" CondicionesDePago="CREDITO" NoCertificado="30001000000400002447" Certificado="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" SubTotal="3890.01" Moneda="MXN" Total="4123.41" MetodoPago="PPD" TipoDeComprobante="I" LugarExpedicion="54020"> <cfdi:Emisor Nombre="TRANSPORTES AVIÑA" Rfc="IIA040805DZ4" RegimenFiscal="601" /> <cfdi:Receptor Rfc="NAL7405305T6" Nombre="ALVEG DISTRIBUCION QUIMICA S.A. DE C.V." UsoCFDI="G03" /> <cfdi:Conceptos> <cfdi:Concepto ValorUnitario="3890.01" Unidad="SERVICIO" Importe="3890.01" NoIdentificacion="002" Descripcion="Actopan 1.5 Tons" ClaveUnidad="E48" ClaveProdServ="78101800" Cantidad="1.00"> <cfdi:Impuestos> <cfdi:Traslados> <cfdi:Traslado Importe="622.40" TasaOCuota="0.160000" TipoFactor="Tasa" Impuesto="002" Base="3890.01" /> </cfdi:Traslados> <cfdi:Retenciones> <cfdi:Retencion Importe="389.00" TasaOCuota="0.100000" TipoFactor="Tasa" Impuesto="002" Base="3890.01" /> </cfdi:Retenciones> </cfdi:Impuestos> </cfdi:Concepto> </cfdi:Conceptos> <cfdi:Impuestos TotalImpuestosTrasladados="622.40" TotalImpuestosRetenidos="389.00"> <cfdi:Retenciones> <cfdi:Retencion Importe="389.00" Impuesto="002" /> </cfdi:Retenciones> <cfdi:Traslados> <cfdi:Traslado Importe="622.40" TipoFactor="Tasa" TasaOCuota="0.160000" Impuesto="002" /> </cfdi:Traslados> </cfdi:Impuestos> <cfdi:Complemento> <cartaporte20:CartaPorte Version="2.0" TranspInternac="No" TotalDistRec="99.00"> <cartaporte20:Ubicaciones> <cartaporte20:Ubicacion TipoUbicacion="Origen" RFCRemitenteDestinatario="NAL7405305T6" FechaHoraSalidaLlegada="2022-11-09T15:00:00"> <cartaporte20:Domicilio Municipio="104" Estado="MEX" Pais="MEX" CodigoPostal="54030"/> </cartaporte20:Ubicacion> <cartaporte20:Ubicacion TipoUbicacion="Destino" RFCRemitenteDestinatario="NAL7405305T6" FechaHoraSalidaLlegada="2022-11-09T16:00:00" DistanciaRecorrida="99.00"> <cartaporte20:Domicilio Municipio="104" Estado="MEX" Pais="MEX" CodigoPostal="54030"/> </cartaporte20:Ubicacion> </cartaporte20:Ubicaciones> <cartaporte20:Mercancias PesoBrutoTotal="30.000" UnidadPeso="KGM" NumTotalMercancias="1"> <cartaporte20:Mercancia BienesTransp="51241301" Descripcion="Acetato de etilo" Cantidad="1" ClaveUnidad="X1A" MaterialPeligroso="No" CveMaterialPeligroso="1173" Embalaje="1A1" PesoEnKg="30.00"> </cartaporte20:Mercancia> <cartaporte20:Autotransporte PermSCT="TPAF01" NumPermisoSCT="156425154"> <cartaporte20:IdentificacionVehicular ConfigVehicular="C2" PlacaVM="XET567" AnioModeloVM="2010"/> <cartaporte20:Seguros AseguraRespCivil="ASE1" PolizaRespCivil="SC152679-A4" AseguraMedAmbiente="ASE3" PolizaMedAmbiente="PolCarga3"/> </cartaporte20:Autotransporte> </cartaporte20:Mercancias> <cartaporte20:FiguraTransporte> <cartaporte20:TiposFigura TipoFigura="01" RFCFigura="LERS521121892" NumLicencia="349848WE"/> </cartaporte20:FiguraTransporte> </cartaporte20:CartaPorte> </cfdi:Complemento> </cfdi:Comprobante>'
cUsuario = "WSDL_PAX"
cPassword = "wqrCssOUw4HDgMSUxJTDq8OkwrQXMnBpSS4Ocm/Cve+/te+9tu++me+/tiEc776v776B"


#Usamos la Petición que PAX usó para Timbrar
cXML = '''<soapenv:Envelope xmlns:soapenv="http://schemas.xmlsoap.org/soap/envelope/" xmlns:test="https://test.paxfacturacion.com.mx:453"> <soapenv:Header/> <soapenv:Body> <test:fnEnviarXML> <!--Optional:--> <test:psComprobante> <![CDATA[ <cfdi:Comprobante xmlns:cartaporte20="http://www.sat.gob.mx/CartaPorte20" xmlns:cfdi="http://www.sat.gob.mx/cfd/3" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv33.xsd http://www.sat.gob.mx/CartaPorte20 http://www.sat.gob.mx/sitio_internet/cfd/CartaPorte/CartaPorte20.xsd" Version="3.3" TipoCambio="1" CondicionesDePago="CREDITO" Serie="FC" Folio="90" Fecha="2022-11-09T13:24:44" Sello="JkORytiJaCg6vkbhguGDjKcrSD78bef645834eugXVoAkXFAg5XozM555JDKmevQ7MuWYaIAmE9K7Hssv/WOy02HOylUp2M2WTSkyXVj4FXI6ZVQhSTtSVf5+diaDdcXAGfb+jeyoGPoPf95xE3wlfrZ4OmBFfBOXuYKnXOEDls1i38hTGzmnXIzMvrA4Sy9UtI1x0B6RnFTYhsTJIA9RIti8LXGX1V5z0jCS4d5sEoUWa77lc1k0W4oZGjbDKiUnXp4ui/7TF/L4alAfa8sShM4CXZ1GzwJFsRc8nENzD//XDd+Z8o7ZAZbGElqa3c/MJECKLBe02+mEdrcJsGE4Q==" FormaPago="99" NoCertificado="30001000000400002447" Certificado="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" SubTotal="3890.01" Moneda="MXN" Total="4123.41" MetodoPago="PPD" TipoDeComprobante="I" LugarExpedicion="54020"> <cfdi:Emisor Nombre="TRANSPORTES AVIÑA" Rfc="IIA040805DZ4" RegimenFiscal="601"/> <cfdi:Receptor Rfc="NAL7405305T6" Nombre="ALVEG DISTRIBUCION QUIMICA S.A. DE C.V." UsoCFDI="G03"/> <cfdi:Conceptos> <cfdi:Concepto ValorUnitario="3890.01" Unidad="SERVICIO" Importe="3890.01" NoIdentificacion="002" Descripcion="Actopan 1.5 Tons" ClaveUnidad="E48" ClaveProdServ="78101800" Cantidad="1.00"> <cfdi:Impuestos> <cfdi:Traslados> <cfdi:Traslado Importe="622.40" TasaOCuota="0.160000" TipoFactor="Tasa" Impuesto="002" Base="3890.01"/> </cfdi:Traslados> <cfdi:Retenciones> <cfdi:Retencion Importe=" 389.00" TasaOCuota="0.100000" TipoFactor="Tasa" Impuesto="002" Base="3890.01"/> </cfdi:Retenciones> </cfdi:Impuestos> </cfdi:Concepto> </cfdi:Conceptos> <cfdi:Impuestos TotalImpuestosRetenidos=" 389.00" TotalImpuestosTrasladados=" 622.40"> <cfdi:Retenciones> <cfdi:Retencion Importe=" 389.00" Impuesto="002"/> </cfdi:Retenciones> <cfdi:Traslados> <cfdi:Traslado Importe=" 622.40" TipoFactor="Tasa" TasaOCuota="0.160000" Impuesto="002"/> </cfdi:Traslados> </cfdi:Impuestos> <cfdi:Complemento> <cartaporte20:CartaPorte Version="2.0" TranspInternac="No" TotalDistRec="99.00"> <cartaporte20:Ubicaciones> <cartaporte20:Ubicacion TipoUbicacion="Origen" RFCRemitenteDestinatario="NAL7405305T6" FechaHoraSalidaLlegada="2022-11-09T15:00:00"> <cartaporte20:Domicilio Municipio="104" Estado="MEX" Pais="MEX" CodigoPostal="54030"/> </cartaporte20:Ubicacion> <cartaporte20:Ubicacion TipoUbicacion="Destino" RFCRemitenteDestinatario="NAL7405305T6" FechaHoraSalidaLlegada="2022-11-09T16:00:00" DistanciaRecorrida="99.00"> <cartaporte20:Domicilio Municipio="104" Estado="MEX" Pais="MEX" CodigoPostal="54030"/> </cartaporte20:Ubicacion> </cartaporte20:Ubicaciones> <cartaporte20:Mercancias PesoBrutoTotal="30.000" UnidadPeso="KGM" NumTotalMercancias="1"> <cartaporte20:Mercancia BienesTransp="13111008" Descripcion="Acetato de Etilo" Cantidad="1" ClaveUnidad="X1A" MaterialPeligroso="Sí" CveMaterialPeligroso="1173" Embalaje="1A1" PesoEnKg="30.00"> </cartaporte20:Mercancia> <cartaporte20:Autotransporte PermSCT="TPAF01" NumPermisoSCT="156425154"> <cartaporte20:IdentificacionVehicular ConfigVehicular="C2" PlacaVM="XET567" AnioModeloVM="2010"/> <cartaporte20:Seguros AseguraRespCivil="ASE1" PolizaRespCivil="SC152679-A4" AseguraMedAmbiente="ASE3" PolizaMedAmbiente="PolCarga3"/> </cartaporte20:Autotransporte> </cartaporte20:Mercancias> <cartaporte20:FiguraTransporte> <cartaporte20:TiposFigura TipoFigura="01" RFCFigura="LERS521121892" NumLicencia="349848WE"/> </cartaporte20:FiguraTransporte> </cartaporte20:CartaPorte> </cfdi:Complemento> </cfdi:Comprobante> ]]> </test:psComprobante> <!--Optional:--> <test:psTipoDocumento>01</test:psTipoDocumento> <test:pnId_Estructura>0</test:pnId_Estructura> <!--Optional:--> <test:sNombre>WSDL_PAX</test:sNombre> <!--Optional:--> <test:sContraseña>wqrCssOUw4HDgMSUxJTDq8OkwrQXMnBpSS4Ocm/Cve+/te+9tu++me+/tiEc776v776B</test:sContraseña> <!--Optional:--> <test:sVersion>3.3 </test:sVersion> </test:fnEnviarXML> </soapenv:Body> </soapenv:Envelope>'''


cXML = cXML.encode('utf-8')
#Creamos la Cabecera de la Petición SOAP
cHeader = {
    "Host" : "test.paxfacturacion.com.mx",
    "Content-Type" : "text/xml; charset=utf-8",
    "Content-length" : str(len(cXML)),
    "SOAPAction" : "https://test.paxfacturacion.com.mx:453/fnEnviarXML"
}
#Request to WebService
response = requests.request("POST", cURL, headers=cHeader, data=cXML)

#Revisamos el Estatus de la Transacción
print(response.status_code)
print(response.text)
#print(response.request)

print(f'\n \n \n {cXML}')
print(cHeader)
#print(len(cXML))
